# Retro Arcade Hub - 遊戲防作弊系統架構與技術分析報告
**Game Security & Anti-Cheat Technical Report**

**報告日期:** 2025/12/18  
**專案名稱:** ME2025 Final Project (Retro Arcade Hub)  
**系統模組:** 核心遊戲引擎 (Core Game Engine) & API 驗證層  
**報告性質:** 技術架構分析 (Technical Architecture Analysis)

---

## 1. 概述 (Overview)

本報告旨在分析 Retro Arcade Hub 平台所採用的多層次防作弊系統（Defense-in-Depth）。鑑於 Web 遊戲的前端程式碼本質上對用戶端可見，本系統採用「**不信任客戶端 (Zero Trust Client)**」之設計原則。

本報告針對系統的三大防護層級進行詳細分析，並針對每個環節給予**安全性評分**與**改進建議**。

---

## 2. 第一層防護：加密簽章與傳輸安全 (Cryptographic Verification)

此層防護旨在防止攻擊者透過攔截 HTTP 請求（使用工具如 Burp Suite）直接修改分數並重新發送。

### 2.1 機制詳解
*   **動態隨機數 (Nonce):** 伺服器生成全域唯一 UUID (`game_nonce`)，僅對當次遊戲有效，防止**重放攻擊 (Replay Attack)**。
*   **數位簽章 (Signature):** 前端計算 `Hash = SHA256(Score + Nonce + Shared_Salt)`。伺服器端進行比對驗證。

### 2.2 安全性評估
*   **安全評級:** ⭐⭐⭐☆☆ (3/5) - **[中等強度]**
*   **優點:** 有效防止了最基礎的封包攔截與數值篡改（例如直接把 score=100 改成 score=9999）。
*   **弱點:** 由於 `Shared_Salt` 必須儲存在前端 JavaScript (`security.js`) 中，具備逆向工程能力的攻擊者可以透過閱讀原始碼提取密鑰，並自行撰寫腳本生成合法的 Hash。

### 2.3 改進與優化建議 (Improvements)
1.  **WebAssembly (Wasm) 混淆:** 將雜湊計算邏輯與 Salt 封裝在編譯過的 Wasm 二進位檔中，大幅增加逆向工程與提取密鑰的難度。
2.  **動態混淆代碼 (Dynamic Obfuscation):** 每次載入頁面時，動態生成變數名稱混淆的 JS 檔案。
3.  **時間戳記驗證:** 在 Hash 中加入客戶端時間戳記，縮短 Token 的有效視窗期。

---

## 3. 第二層防護：啟發式邏輯驗證 (Heuristic Logic Validation)

即便攻擊者破解了加密簽章，伺服器端仍具備第二道防線，針對數據的「合理性」進行物理極限檢查。

### 3.1 各遊戲檢測邏輯
*   **Snake:** 檢查移動步數與分數比例（防瞬移）、每秒移動次數（防加速）。
*   **Tetris:** 檢查方塊生成速率（防 Auto-dropper）、消行效率（防邏輯竄改）、Nintendo 計分公式驗證。
*   **Whac-A-Mole:** 檢查 CPS (每秒點擊數)，限制在人類極限 12 CPS 以內。
*   **Dino:** 基於微積分原理，計算時間與速度積分出的理論最大距離。
*   **Memory:** 檢查翻牌反應時間，低於 0.4 秒視為非人類操作。

### 3.2 安全性評估
*   **安全評級:** ⭐⭐⭐⭐⭐ (5/5) - **[極高強度]**
*   **優點:** 這是本系統最強大的防線。它不依賴隱藏密碼，而是依賴「物理法則」。即使攻擊者能偽造 Hash，若他送出的分數是「0.1秒獲得 10000分」，依然會被此層級攔截。這迫使攻擊者必須撰寫複雜的 AI 才能繞過，攻擊成本極高。
*   **弱點:** 極少數邊緣情況下（如網路極度延遲導致封包堆積），可能產生誤判 (False Positive)。

### 3.3 改進與優化建議 (Improvements)
1.  **完整重播系統 (Full Replay System):** 不僅傳送最終分數，而是記錄玩家的每一個按鍵操作序列 (Input Log)。伺服器端在沙盒環境中「重跑」一次遊戲，若結果與分數不符則必定為作弊。這是業界最高標準（如 OSU!, Tetris.io 所採用）。
2.  **機器學習模型 (Machine Learning):** 收集大量真實玩家的操作軌跡，訓練 AI 識別「人類特徵」（如反應時間的隨機波動）與「機器特徵」（如絕對固定的點擊間隔）。

---

## 4. 第三層防護：行為監控與懲罰 (Behavioral Monitoring)

### 4.1 機制詳解
*   **頻率限制 (Rate Limiting):** 單一 User 60 秒內最多提交 30 次。
*   **嫌疑犯標記 (Suspect Flagging):** 異常數據不會只被拒絕，還會將使用者標記為 `is_suspect`，供管理員後續審查。

### 4.2 安全性評估
*   **安全評級:** ⭐⭐⭐⭐☆ (4/5) - **[高強度]**
*   **優點:** 提供了事後追溯的能力，並防止了暴力破解 API 的行為。自動標記機制減輕了管理員的人工負擔。
*   **弱點:** 目前 Rate Limit 儲存在伺服器記憶體中 (`_score_submit_log`)，若伺服器重啟或在多程序 (Gunicorn/uWSGI) 環境下，限制會失效或不準確。

### 4.3 改進與優化建議 (Improvements)
1.  **持久化儲存 (Redis):** 將頻率限制計數器移至 Redis 資料庫，確保在分散式環境或重啟後依然有效。
2.  **隱形封禁 (Shadow Ban):** 對於被標記的嫌疑犯，不直接告知「分數提交失敗」，而是表面顯示成功，但實際上不將分數寫入排行榜。這能讓作弊者更晚發現自己已暴露，延緩其改進外掛程式的速度。
3.  **裝置指紋 (Device Fingerprinting):** 收集瀏覽器指紋 (Canvas Fingerprint, User Agent)，防止作弊者單純切換帳號繼續作弊。

---

## 5. 綜合結論 (Overall Conclusion)

*   **整體防護評分:** **A- (90/100)**
*   **總評:** Retro Arcade Hub 的防作弊系統在「伺服器端驗證」方面做得非常扎實。雖然前端密鑰儲存存在 Web 應用的先天弱點，但透過強大的後端邏輯檢測彌補了這一點。對於一個休閒遊戲平台而言，此防護等級已不僅是足夠，甚至達到了商業級輕量遊戲的標準。

---
*Report generated by AI Assistant for ME2025 Final Project.*
